<!DOCTYPE html>
<html lang="en">

<head>
  <%-head%>
</head>

<body>

  <%-nav%>

    <div class="mx-5">

      <div class="mt-5">
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col">CSR No</th>
              <th scope="col">Customer</th>
              <th scope="col">Enquiry No</th>
              <th scope="col">Enquiry</th>
              <th scope="col">Enquiry Date</th>
              <th scope="col">File</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            
          </tbody>
        </table>
      </div>

      <%-script%>
        <script>

            $(document).ready(function () {
              $.ajax({
                url: '/api/v1/enquiry/list',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ type: 1, status:1 }), // Ensure data is stringified
                success: function (response) {
                    if (response.status) {
                      console.log("ðŸš€ ~ response:", response.data);

                      const tableBody = document.getElementById('tableBody');
                      tableBody.innerHTML = ''; // Clear existing table data

                      response.data.forEach(data => {
                        const dateString = data.added_time;
                        const dateObject = new Date(dateString);
                        const formattedDate = `${dateObject.getMonth() + 1}/${dateObject.getDate()}/${dateObject.getFullYear()}`;
                        tableBody.innerHTML += `
                          <tr>
                            <td>${data.gsr_number}</td>
                            <td>${data.client_name}</td>
                            <td>${data.enq_number}</td>
                            <td>Costing Request</td>
                            <td>${formattedDate}</td>
                            <td>${data.file ? `<a href="${data.file}" target="_blank">View File</a>` : 'No File'}</td>
                            <td>
                                <div class="d-flex gap-3">
                                  <a href="/enquiry-form-view/${data.id}"><i class="fa-solid fa-pen-to-square"></i></a>
                                  
                                </div>
                            </td>
                          </tr>
                            `;
                        });

                    } else {
                        showAlert({
                            message: "ERROR: " + response.message,
                            closeText: 'ok',
                        });
                    }
                },
                error: function (error) {
                    console.log("AJAX Error:", error);
                }
              });
          });


          $(document).ready(function () {
            $('.delete-button').click(function (e) {
              e.preventDefault();
              var id = $(this).data('id');
              deleteClient(id);
            });
          });
          function deleteClient(id) {
            showAlert({
              message: "Are you sure you want to delete this client?",
              closeText: 'no',
              acceptText: 'yes',
              acceptFunction: () => {
                $.ajax({
                  url: '/api/v1/client/delete',
                  type: 'POST',
                  data: { id: id },
                  success: function (response) {
                    if (response.status) {
                      location.reload();
                    } else {
                      showAlert({
                        message: "ERROR: " + response.message,
                        closeText: 'ok',
                      });
                    }
                  },
                  error: function (err) {
                    console.log(err);
                  }
                });
              },
            });
          }
        </script>

</body>

</div>

</html>