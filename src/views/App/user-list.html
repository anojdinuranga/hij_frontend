<!DOCTYPE html>
<html lang="en">

<head>
  <%-head%>
</head>

<body>

  <%-nav%>

    <div class="mx-5">

      <div class="mt-5">
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col">Employee number</th>
              <th scope="col">Employee name</th>
              <th scope="col">Contact number</th>
              <th scope="col">Email address</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody id="tableBody">



          </tbody>
        </table>
      </div>

      <%-script%>
        <script>

          $(document).ready(function () {
            $.ajax({
              url: '/api/v1/user/list',
              type: 'POST',
              contentType: 'application/json',
              data: {},
              success: function (response) {
                if (response.status) {
                  console.log("ðŸš€ ~ response:", response.data)

                  const tableBody = document.getElementById('tableBody');

                  response.data.forEach(data => {
                    tableBody.innerHTML += `
                      <tr>
                        <td>${data.employee_number}</td>
                        <td>${data.name}</td>
                        <td>${data.mobile}</td>
                        <td>${data.email}</td>
                        <td>
                            <div class="d-flex gap-3">
                                <i class="fa-solid fa-pen-to-square"></i>
                                <i class="fa-solid fa-trash text-danger" onclick=(deleteUser(${data.id}))></i>
                            </div>
                            
                        </td>
                    </tr>
                    `
                  });

                } else {
                  showAlert({
                    message: "ERROR: " + response.message,
                    closeText: 'ok',
                  });
                }
              },
              error: function (error) {
                console.log(error);
              }
            });
          });

          function deleteUser(id) {
            showAlert({
              message: "Are you sure you want to delete this user?",
              closeText: 'no',
              acceptText: 'yes',
              acceptFunction: () => {
                $.ajax({
                  url: '/api/v1/user/delete',
                  type: 'POST',
                  data: { userId: id },
                  success: function (response) {
                    if (response.status) {
                      location.reload();
                    } else {
                      showAlert({
                        message: "ERROR: " + response.message,
                        closeText: 'ok',
                      });
                    }
                  },
                  error: function (err) {
                    console.log(err);
                  }
                });
              },
            });
          }
        </script>

</body>

</div>

</html>