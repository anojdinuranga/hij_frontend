<!DOCTYPE html>
<html lang="en">

<head>
    <%-head%>
</head>

<body>

    <%-nav%>

        <div class="mx-5">

            <div class="row mt-5">
                <div class="col-md-9">
                    <div class="form-group w-100 mb-5">
                        <label class="form-label mb-3" for="">Clients Name</label>
                        <input type="text" class="form-control w-full" id="clientName">
                    </div>

                    <div class="form-group w-100 mb-5">
                        <label class="form-label mb-3" for="">Contact Number</label>
                        <input type="text" class="form-control w-full" id="contactNumber">
                    </div>

                    <div class="form-group w-100 mb-5">
                        <label class="form-label mb-3" for="">Email ID</label>
                        <input type="text" class="form-control w-full" id="emailId">
                    </div>

                    <div class="form-group w-100 mb-5">
                        <label class="form-label mb-3" for="">POC</label>
                        <input type="text" class="form-control w-full" id="poc">
                    </div>

                    <div class="form-group w-100 mb-5">
                        <label class="form-label mb-3" for="">POC Contact Number</label>
                        <input type="text" class="form-control w-full" id="pocContact">
                    </div>

                    <div class="form-group w-100 mb-5">
                        <label class="form-label mb-3" for="">Head Office Address</label>
                        <input type="text" class="form-control w-full" id="headOfficeAddress">
                    </div>
                </div>

                <div class="col-md-1"></div>

                <div class="col-md-2">
                    <div class="form-group w-100 mb-5 text-start">
                        <div class="image-upload border border-3 d-flex align-items-center justify-content-center"
                            id="image_preview">
                            <img src="/assets/images/icons/plus-square (1).svg" alt="">
                            <input type="file" name="" id="logo" class="d-none">
                        </div>
                        <label class="form-label mb-3" for="">Add Logo</label>
                    </div>
                </div>
            </div>

            <div class="footer">
                <button class="btn btn-primary mb-4 theme-primary-btn" id="submit-button">Save</button>
            </div>

            <%-script%>
                <script>
                    $(document).ready(function () {
                        $("#submit-button").click(addData);

                        $('#image_preview').click(function () {
                            document.getElementById('logo').click();
                        });

                        $('#logo').change(function () {
                            uploadedFile = '';
                            var input = this;
                            var url = $(this).val();
                            var ext = url.substring(url.lastIndexOf('.') + 1).toLowerCase();
                            if (input.files && input.files[0] && (ext == "gif" || ext == "png" || ext == "jpeg" || ext == "jpg")) {
                                var reader = new FileReader();

                                reader.onload = function (e) {
                                    $('#image_preview').find('img').attr('src', e.target.result);
                                    $('#image_preview').find('img').addClass('w-100 h-100 object-fit-cover');
                                }

                                reader.readAsDataURL(input.files[0]);
                            }
                        });

                    });

                    function addClient() {

                        $.ajax({
                            url: '/api/v1/client/add',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                "name": $("#clientName").val(),
                                "contactNumber": $("#contactNumber").val(),
                                "email": $("#emailId").val(),
                                "pocName": $("#poc").val(),
                                "pocContactNumber": $("#pocContact").val(),
                                "headOfficeAddress": $("#headOfficeAddress").val(),
                                "logo": uploadedFile == '' ? null : uploadedFile
                            }),
                            success: function (response) {
                                if (response.status) {
                                    showAlert({
                                        message: "Success: Client added successfully",
                                        closeText: 'ok',
                                        closeFunction: function () {
                                            window.location.href = '/client-list';
                                        },
                                    });
                                } else {
                                    showAlert({
                                        message: "ERROR: " + response.message,
                                        closeText: 'ok',
                                    });
                                }
                            },
                            error: function (error) {
                                console.log(error);
                            }
                        });

                    };

                    var uploadedFile = '';

                    function addData() {
                        var formData = new FormData();
                        var logo = $("#logo")[0].files[0];
                        if (logo && uploadedFile == '') {
                            formData.append('file', logo);
                            $.ajax({
                                url: '/file/upload',
                                type: 'POST',
                                data: formData,
                                contentType: false,
                                processData: false,
                                success: function (data) {
                                    console.log("ðŸš€ ~ addData ~ data:", data)

                                    if (!data.status) {
                                        showAlert({
                                            message: "ERROR: " + data.message,
                                            closeText: 'ok',
                                        });
                                    }
                                    else {
                                        uploadedFile = data.data.file;
                                        addClient();
                                    }
                                },
                                error: function (err) {
                                    showAlert({
                                        message: "ERROR: " + err,
                                        closeText: 'ok',
                                    });
                                }
                            });
                        } else {
                            addClient();
                        }

                    }
                </script>
</body>

</div>

</html>