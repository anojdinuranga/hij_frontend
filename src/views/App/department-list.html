<!DOCTYPE html>
<html lang="en">

<head>
  <%-head%>
</head>

<body>

  <%-nav%>

    <div class="container">

      <div class="mt-5">
        <table class="table table-striped">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Department name</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody id="tableBody">



          </tbody>
        </table>
      </div>

      <%-script%>
        <script>

          $(document).ready(function () {
            $.ajax({
              url: '/api/v1/department/list',
              type: 'GET',
              contentType: 'application/json',
              data: {},
              success: function (response) {
                if (response.status) {
                  console.log("ðŸš€ ~ response:", response.data)

                  const tableBody = document.getElementById('tableBody');

                  response.data.forEach(data => {
                    tableBody.innerHTML += `
                      <tr>
                        <td>${data.id}</td>
                        <td>${data.department_name}</td>
                        <td>
                            <div class="d-flex gap-3">
                                <a href="/department-edit/${data.id}"><i class="fa-solid fa-pen-to-square"></i></a>
                                <i class="fa-solid fa-trash text-danger mt-1" style="cursor:pointer;" onclick="deleteDepartment(${data.id})"></i>
                            </div>
                            
                        </td>
                    </tr>
                    `
                  });

                } else {
                  showAlert({
                    message: "ERROR: " + response.message,
                    closeText: 'ok',
                  });
                }
              },
              error: function (error) {
                console.log(error);
              }
            });
          });

          function deleteDepartment(id){
            showAlert({
                message:"Are you sure you want to delete this Department ?",
                closeText:'no',
                acceptText:'yes',
                acceptFunction: ()=>{
                  $.ajax({
                    url: '/api/v1/department/delete',
                    type: 'POST',
                    data: {departmentId:id},
                    success: function(response){
                      if(response.status){
                        location.reload();
                      }else{
                        showAlert({
                          message:"ERROR: "+response.message,
                          closeText:'ok',
                        });
                      }
                    },
                    error: function(err){
                      console.log(err);
                    }
                  });
                },
            });
          }
        </script>

</body>

</div>

</html>